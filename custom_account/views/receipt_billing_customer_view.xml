<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>

        <record model="ir.ui.view" id="receipt_billing_customer_form_view">
            <field name="name">receipt.billing.customer.form</field>
            <field name="model">receipt.billing.customer</field>
            <field name="arch" type="xml">
                <form string="Receipt Customer Bill Form">
                    <header>
                        <button name="action_done" string="Done" class="oe_highlight"
                                type="object" groups="account.group_account_user"
                                attrs="{'invisible': [('state', '!=', 'draft')]}"/>
                        <button name="button_cancel" string="Cancel" type="object" groups="account.group_account_user"
                                attrs="{'invisible' : ['|', ('id', '=', False), ('state', '=', 'cancel')]}"/>
                        <field name="state" widget="statusbar" statusbar_visible="draft,done"/>
                    </header>
                    <sheet>
                        <!-- Invisible fields -->
                        <field name="is_reconciled" invisible="1"/>
                        <field name="journal_id_domain" invisible="1"/>

                        <div class="oe_button_box" name="button_box">
                            <!-- Stat button to open the manual reconciliation widget -->
                            <button name="action_open_manual_reconciliation_widget" type="object"
                                    string="Payment Matching" class="oe_stat_button" icon="fa-dollar"
                                    groups="account.group_account_user"
                                    attrs="{'invisible': ['|', '|', ('reconciled_invoices_count','>',0), ('is_reconciled', '=', True), ('state', '!=', 'done')]}"
                            />

                            <!-- Invoice stat button -->
                            <button name="button_open_invoices" type="object"
                                    class="oe_stat_button" icon="fa-bars"
                                    attrs="{'invisible': [('reconciled_invoices_count','=', 0)]}">
                                <field name="reconciled_invoices_count"/>
                                <span attrs="{'invisible': [('reconciled_invoices_count','&gt;', 1)]}">Invoice</span>
                                <span attrs="{'invisible': [('reconciled_invoices_count','&lt;=', 1)]}">Invoices</span>
                            </button>

                            <!-- Bill stat button -->
                            <button name="button_open_bills" type="object"
                                    class="oe_stat_button" icon="fa-bars"
                                    attrs="{'invisible': [('reconciled_bills_count','=', 0)]}">
                                <field name="reconciled_bills_count"/>
                                <span attrs="{'invisible': [('reconciled_bills_count','&gt;', 1)]}">Bill</span>
                                <span attrs="{'invisible': [('reconciled_bills_count','&lt;=', 1)]}">Bills</span>
                            </button>

                            <!-- Statement stat button -->
                            <button name="button_open_statements" type="object"
                                    class="oe_stat_button" icon="fa-bars"
                                    attrs="{'invisible': [('reconciled_statements_count','=', 0)]}">
                                <field name="reconciled_statements_count"/>
                                <span attrs="{'invisible': [('reconciled_statements_count','&gt;', 1)]}">Statement</span>
                                <span attrs="{'invisible': [('reconciled_statements_count','&lt;=', 1)]}">Statements</span>
                            </button>

                            <!-- Journal Entry  button -->
                            <button name="button_open_journal_entry" type="object" 
                                    class="oe_stat_button" icon="fa-bars"
                                    attrs="{'invisible': ['|',('state', '=', 'draft'),('move_id', '=', False)]}">
                                Journal Entry
                            </button>
                        </div>

                        <div class="oe_title">
                            <!-- <span class="o_form_label">Number</span> -->
                            <!-- Receipt draft header -->
                            <h1>
                                <span attrs="{'invisible': ['|', ('state', '!=', 'draft'), ('name', '!=', '/')]}">Draft</span>
                            </h1>
                            <!-- Number -->
                            <h1 class="mt0" attrs="{'invisible':[('name', '=', '/')]}">
                                <field name="name" attrs="{'readonly': [('state', '!=', 'draft')]}" placeholder="RVEB/2021/02/001"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="company_id" invisible="1"/>

                                <field name="partner_id"
                                    options="{'always_reload': True, 'no_create': True}"
                                    widget="res_partner_many2one"
                                    context="{'show_address': 1, 'default_is_company': True, 'show_vat': True}"
                                />
                                <!-- <field name="partner_address"/> -->
                            </group>
                            <group>
                                <field name="document_date"/>
                                <field name="document_date_due"/>
                                <field name="user_id"/>
                            </group>
                        </group>

                        <style>
                        hr {
                          margin-top: -0.5em;
                          margin-bottom: 0.0em;
                          margin-left: auto;
                          margin-right: auto;
                          height: 1px;
                          border-width: 0px;
                          color: #E5E4E2;
                          background-color: #E5E4E2;
                        }
                        </style>
                        <hr/>
                        <group>
                            <group>
                                <field name="bank_account_id" options="{'no_create': True}"/>
                            </group>
                            <group>
                                <field name="move_id" invisible="1"/>
                                <field name="journal_id" options="{'no_create': True}"/>
                            </group>
                        </group>

                        <notebook>
                            <page string="List of Invoice">
                                <field name="line_ids" attrs="{'readonly': [('state', 'in', ('done', 'cancel'))]}">
                                    <tree string="Bill Lines">
                                        <field name="bill_id"/>
                                        <field name="bill_date_due"/>
                                        <!-- <field name="bill_total"/> -->
                                        <field name="bill_residual"/>

                                        <!-- === Payment fields === -->
                                        <field name="pay"/>
                                        <field name="amount"/>
                                        <field name="deducts"/>
                                        <field name="balance"/>

                                        <field name="note"/>
                                    </tree>
                                </field>

                                <style>
                                .right-bar {
                                  border-right: 1px solid #dddddd;
                                }
                                </style>
                                <group>
                                    <table class="table" style="text-align: center">
                                        <thead>
                                            <tr>
                                                <th scope="col" class="right-bar">
                                                    จำนวน 
                                                    <field name="line_count"/>
                                                    ฉบับ
                                                </th>
                                                <th scope="col" class="right-bar">
                                                    <field name="amount_total"/>
                                                </th>
                                                <th scope="col">
                                                    (
                                                    <field name="amount_total_text"/>
                                                    )
                                                </th>
                                            </tr>
                                        </thead>
                                    </table>
                                </group>
                            </page>
                            <page id="other_tab_entry" string="Other Info" name="other_info">
                                <group id="other_tab_entry_group">
                                    <group>
                                        <field name="company_id" groups="base.group_multi_company" options="{'no_create': True}"/>
                                        <field name="company_currency_id" options="{'no_create': True}"/>
                                    </group>
                                    <group>
                                    </group>
                                </group>
                            </page>
                        </notebook>
                        <group col="4">
                            <group colspan="3">
                                <field name="narration" class="oe_inline"/>
                            </group>
                        </group>

                    </sheet>
                    <div class="oe_chatter" name="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="message_ids"/>
                        <field name="activity_ids"/>
                    </div>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="receipt_billing_customer_search_view">
            <field name="name">receipt.billing.customer.search</field>
            <field name="model">receipt.billing.customer</field>
            <field name="arch" type="xml">
                <search>
                    <field name="name"/>
                    <field name="partner_id"/>
                    <field name="document_date"/>
                    <field name="document_date_due"/>
                    <field name="user_id"/>
                    <field name="state"/>
                    <field name="line_ids" filter_domain="[('line_ids.name','ilike',self)]" string="ST No."/>
                    <filter name="my_receipt_billing_customer"
                            string="My Receipt Customer Bill"
                            domain="[('user_id', '=', uid)]"/>
                    <filter name="done_status"
                            string="Done Status"
                            domain="[('state', '=', 'done')]"/>
                    <filter name="draft_status"
                            string="Draft Status"
                            domain="[('state', '=', 'draft')]"/>
                    <group string="Group By">
                        <filter name="by_customer"
                                string="Customer"
                                context="{'group_by': 'partner_id'}"/>
                        <filter name="by_user"
                                string="User"
                                context="{'group_by': 'user_id'}"/>
                        <filter name="by_status"
                                string="Status"
                                context="{'group_by': 'state'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record model="ir.ui.view" id="receipt_billing_customer_tree_view">
            <field name="name">receipt.billing.customer.tree</field>
            <field name="model">receipt.billing.customer</field>
            <field name="arch" type="xml">
                <tree string="Receipt Customer Bill Tree">
                    <field name="name"/>
                    <field name="partner_id"/>
                    <field name="document_date"/>
                    <field name="document_date_due"/>
                    <field name="user_id"/>
                    <field name="reconcile_status"
                        widget="badge"
                        decoration-success="reconcile_status not in ['Draft', 'Cancelled']"
                        optional="show"/>
                    <field name="state" widget="badge" decoration-success="state == 'done'" decoration-info="state == 'draft'"/>

                    <!-- <button name="button_open_invoices" type="object" class="oe_stat_button" icon="fa-bars"/> -->
                    <field name="reconciled_invoice_ids"
                           widget="badge"
                           decoration-danger="bool(reconciled_invoice_ids) == False"
                           decoration-success="bool(reconciled_invoice_ids) == True"
                           optional="show"/>
                    <!-- <field name="reconcile_state"
                           widget="badge"
                           decoration-danger="reconcile_state == 'not_reconcile'"
                           decoration-success="reconcile_state == 'reconciled'"
                           optional="show"/> -->
                </tree>
            </field>
        </record>


        <record model="ir.ui.view" id="receipt_billing_customer_line_form_view">
            <field name="name">receipt.billing.customer.line.form</field>
            <field name="model">receipt.billing.customer.line</field>
            <field name="arch" type="xml">
                <form string="Receipt Customer Bill Line Form">
                    <sheet>
                        <div class="oe_title">
                            <!-- <span class="o_form_label">Label</span> -->
                            <h1>
                                <field name="name"/>
                            </h1>
                        </div>
                        <group>
                            <group>
                                <field name="company_id" invisible="1"/>
                                <field name="receipt_id" invisible="1"/>
                                <field name="bill_id_domain" invisible="1"/>

                                <field name="bill_id"
                                    options="{'no_create': True}"/>
                                <field name="bill_date_due"/>
                                <!-- <field name="bill_total"/> -->
                                <field name="bill_residual" readonly="1" force_save="1"/>
                            </group>
                            <group>
                                <field name="pay"/>
                                <field name="amount"/>
                                <field name="deducts"/>
                                <field name="balance"/>
                            </group>
                        </group>
                        <div class="oe_title">
                            <label for="note"/>
                            <field name="note"/>
                        </div>

                        <notebook>
                            <page string="List of Deduction">
                                <!-- <field name="deduct_ids" attrs="{'readonly': [('state', 'in', ('done', 'cancel'))]}"> -->
                                <field name="deduct_ids" options="{'no_open': True}">
                                    <tree string="Bill Deduct" editable="bottom" create="true" delete="true">
                                        <!-- === Deduction fields === -->
                                        <field name="deduct_type"/>
                                        <field 
                                            name="tax_id"
                                            options="{'no_create': True}"
                                            attrs="{
                                                'readonly': [('deduct_type', '!=', 'tax')],
                                            }"
                                        />
                                        <field name="tax_amount_show" readonly="1" force_save="1"/>
                                        <field 
                                            name="account_code"
                                            force_save="1"
                                            options="{'no_create': True}"
                                            attrs="{
                                                'readonly': [('deduct_type', '=', 'tax')],
                                            }"
                                        />
                                        <field name="deduct_amount" force_save="1"/>
                                    </tree>
                                </field>
                            </page>
                        </notebook>

                    </sheet>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="receipt_billing_customer_line_tree_view">
            <field name="name">receipt.billing.customer.line.tree</field>
            <field name="model">receipt.billing.customer.line</field>
            <field name="arch" type="xml">
                <tree string="Receipt Customer Bill Line Tree">
                    <field name="bill_id"/>
                    <field name="receipt_id"/>
                    <field name="bill_date_due"/>
                    <field name="bill_total"/>
                    <field name="bill_residual"/>

                    <!-- === Payment fields === -->
                    <field name="pay"/>
                    <field name="amount"/>
                    <field name="deducts"/>
                    <field name="balance"/>
                </tree>
            </field>
        </record>


        <record model="ir.actions.act_window" id="receipt_billing_customer_list_action">
            <field name="name">Receipt Customer Bill</field>
            <field name="res_model">receipt.billing.customer</field>
            <field name="view_mode">tree,form</field>
            <field name="context" eval="{'search_default_my_receipt_billing_customer': False}"/>
            <field name="help" type="html">
                <p class="o_view_nocontent_smiling_face">Create first Receipt Customer Bill</p>
            </field>
        </record>

        <menuitem
            id="receipt_billing_customer_menu"
            name="Receipt Customer Bill"
            parent="account.menu_finance_receivables"
            action="receipt_billing_customer_list_action"
            sequence="200"
        />

    </data>
</odoo>
